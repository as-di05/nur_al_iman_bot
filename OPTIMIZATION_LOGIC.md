# –õ–æ–≥–∏–∫–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API

## –ü—Ä–æ–±–ª–µ–º–∞
–ï—Å–ª–∏ —É –Ω–∞—Å 1000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∏ –∫–∞–∂–¥—ã–π –≤—ã–±—Ä–∞–ª —Å–≤–æ–π –≥–æ—Ä–æ–¥, –Ω–∞–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –¥–µ–ª–∞–ª –±—ã 1000 –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 00:30.

## –†–µ—à–µ–Ω–∏–µ
–ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ `locationCode` –∏ –¥–µ–ª–∞–µ–º —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –∫ API –Ω–∞ –∫–∞–∂–¥—ã–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –≥–æ—Ä–æ–¥.

## –ü—Ä–∏–º–µ—Ä

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ –æ–¥–Ω–æ–º –≥–æ—Ä–æ–¥–µ
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ MongoDB:
- user_1: locationCode=1 (–ë–∏—à–∫–µ–∫)
- user_2: locationCode=1 (–ë–∏—à–∫–µ–∫)
- user_3: locationCode=1 (–ë–∏—à–∫–µ–∫)
...
- user_1000: locationCode=1 (–ë–∏—à–∫–µ–∫)

–†–µ–∑—É–ª—å—Ç–∞—Ç: 1 –∑–∞–ø—Ä–æ—Å –∫ API –≤–º–µ—Å—Ç–æ 1000
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ —Ä–∞–∑–Ω—ã—Ö –≥–æ—Ä–æ–¥–∞—Ö
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ MongoDB:
- user_1: locationCode=1 (–ë–∏—à–∫–µ–∫)
- user_2: locationCode=1 (–ë–∏—à–∫–µ–∫)
- user_3: locationCode=2 (–û—à)
- user_4: locationCode=1 (–ë–∏—à–∫–µ–∫)
- user_5: locationCode=3 (–î–∂–∞–ª–∞–ª-–ê–±–∞–¥)
- user_6: locationCode=2 (–û—à)
...

–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞:
- locationCode=1: [user_1, user_2, user_4, ...] ‚Üí 500 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- locationCode=2: [user_3, user_6, ...] ‚Üí 300 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- locationCode=3: [user_5, ...] ‚Üí 200 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–†–µ–∑—É–ª—å—Ç–∞—Ç: 3 –∑–∞–ø—Ä–æ—Å–∞ –∫ API –≤–º–µ—Å—Ç–æ 1000
```

## –ê–ª–≥–æ—Ä–∏—Ç–º –≤ –∫–æ–¥–µ

```javascript
// –®–∞–≥ 1: –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ MongoDB
const users = await getAllActiveUsers();
// [
//   { userId: 1, locationCode: 1 },
//   { userId: 2, locationCode: 1 },
//   { userId: 3, locationCode: 2 },
//   ...
// ]

// –®–∞–≥ 2: –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ locationCode
const usersByLocation = {
  1: [1, 2, 4, ...],  // 500 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –ë–∏—à–∫–µ–∫–µ
  2: [3, 6, ...],      // 300 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –û—à–µ
  3: [5, ...],         // 200 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –î–∂–∞–ª–∞–ª-–ê–±–∞–¥–µ
};

// –®–∞–≥ 3: –î–ª—è –∫–∞–∂–¥–æ–π —É–Ω–∏–∫–∞–ª—å–Ω–æ–π –ª–æ–∫–∞—Ü–∏–∏ (–¢–û–õ–¨–ö–û 3 –∑–∞–ø—Ä–æ—Å–∞!)
for (const [locationCode, userIds] of Object.entries(usersByLocation)) {
  // –û–î–ò–ù –∑–∞–ø—Ä–æ—Å –∫ API –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —ç—Ç–æ–≥–æ –≥–æ—Ä–æ–¥–∞
  const times = await getPrayerTimes(locationCode);

  // –®–∞–≥ 4: –°–æ–∑–¥–∞–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —ç—Ç–æ–≥–æ –≥–æ—Ä–æ–¥–∞
  for (const [namazName, time] of Object.entries(times)) {
    // –û–î–ù–ê –∫—Ä–æ–Ω-–∑–∞–¥–∞—á–∞ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —ç—Ç–æ–≥–æ –≥–æ—Ä–æ–¥–∞
    cron.schedule(cronTime, async () => {
      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —ç—Ç–æ–≥–æ –≥–æ—Ä–æ–¥–∞
      for (const userId of userIds) {
        await sendNotification(userId, time);
      }
    });
  }
}
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

### –í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ:
```
üìã –ù–∞–π–¥–µ–Ω–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 1000
üìç –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ª–æ–∫–∞—Ü–∏–π: 3 (–≤–º–µ—Å—Ç–æ 1000 –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API)

üåç –û–±—Ä–∞–±–æ—Ç–∫–∞ –ª–æ–∫–∞—Ü–∏–∏: –ë–∏—à–∫–µ–∫ (–∫–æ–¥ 1)
   üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —ç—Ç–æ–º –≥–æ—Ä–æ–¥–µ: 500
   ‚úÖ –ü–æ–ª—É—á–µ–Ω—ã –≤—Ä–µ–º–µ–Ω–∞ –Ω–∞–º–∞–∑–æ–≤
   üìÖ –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –¥–ª—è 500 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...

üåç –û–±—Ä–∞–±–æ—Ç–∫–∞ –ª–æ–∫–∞—Ü–∏–∏: –û—à (–∫–æ–¥ 2)
   üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —ç—Ç–æ–º –≥–æ—Ä–æ–¥–µ: 300
   ‚úÖ –ü–æ–ª—É—á–µ–Ω—ã –≤—Ä–µ–º–µ–Ω–∞ –Ω–∞–º–∞–∑–æ–≤
   üìÖ –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –¥–ª—è 300 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...

üåç –û–±—Ä–∞–±–æ—Ç–∫–∞ –ª–æ–∫–∞—Ü–∏–∏: –î–∂–∞–ª–∞–ª-–ê–±–∞–¥ (–∫–æ–¥ 3)
   üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —ç—Ç–æ–º –≥–æ—Ä–æ–¥–µ: 200
   ‚úÖ –ü–æ–ª—É—á–µ–Ω—ã –≤—Ä–µ–º–µ–Ω–∞ –Ω–∞–º–∞–∑–æ–≤
   üìÖ –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –¥–ª—è 200 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...

‚úÖ –í—Å–µ–≥–æ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ –∑–∞–¥–∞—á: 15 (5 –Ω–∞–º–∞–∑–æ–≤ √ó 3 –≥–æ—Ä–æ–¥–∞)
```

## –ö–æ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ

1. **–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞** - –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Å–æ–∑–¥–∞–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
2. **–ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 00:30** - –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –≤—Ä–µ–º–µ–Ω–∞–º–∏

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- ‚úÖ –ú–∏–Ω–∏–º—É–º –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API
- ‚úÖ –ë—ã—Å—Ç—Ä–∞—è —Ä–∞–±–æ—Ç–∞ –¥–∞–∂–µ —Å —Ç—ã—Å—è—á–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –≠–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞
- ‚úÖ –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –≤–Ω–µ—à–Ω–∏–π API muftiyat.kg
